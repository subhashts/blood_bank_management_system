{% extends "base.html" %}

{% block title %}Reports - Blood Management System{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-info">
            <i class="fas fa-chart-bar me-2"></i>Reports & Analytics
        </h2>
        <a href="{{ url_for('hospital.dashboard') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>
    
    <!-- Report Categories -->
    <div class="row">
        <!-- Donation Reports -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-heart me-2"></i>Donation Reports
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">Generate detailed reports of blood donations received at your hospital.</p>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('hospital.download_report', report_type='donations_monthly') }}" 
                           class="btn btn-outline-success">
                            <i class="fas fa-download me-2"></i>Monthly Donations Report
                        </a>
                        <a href="{{ url_for('hospital.download_report', report_type='donations_yearly') }}" 
                           class="btn btn-outline-success">
                            <i class="fas fa-download me-2"></i>Yearly Donations Report
                        </a>
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Reports include donor details, blood groups, donation dates, and approval status.
                        </small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Request Reports -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>Request Reports
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">Generate reports of blood requests received from patients.</p>
                    
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('hospital.download_report', report_type='requests_monthly') }}" 
                           class="btn btn-outline-warning">
                            <i class="fas fa-download me-2"></i>Monthly Requests Report
                        </a>
                        <a href="{{ url_for('hospital.download_report', report_type='requests_yearly') }}" 
                           class="btn btn-outline-warning">
                            <i class="fas fa-download me-2"></i>Yearly Requests Report
                        </a>
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Reports include patient details, blood groups, request types, and response status.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Report Information -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Report Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-success">Donation Reports Include:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Donor name and contact information</li>
                                <li><i class="fas fa-check text-success me-2"></i>Blood group and units donated</li>
                                <li><i class="fas fa-check text-success me-2"></i>Donation dates and approval status</li>
                                <li><i class="fas fa-check text-success me-2"></i>Certificate generation status</li>
                                <li><i class="fas fa-check text-success me-2"></i>Inventory impact tracking</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-warning">Request Reports Include:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-warning me-2"></i>Patient name and contact information</li>
                                <li><i class="fas fa-check text-warning me-2"></i>Blood group and units requested</li>
                                <li><i class="fas fa-check text-warning me-2"></i>Request type (Normal/Critical)</li>
                                <li><i class="fas fa-check text-warning me-2"></i>Request and response dates</li>
                                <li><i class="fas fa-check text-warning me-2"></i>Approval status and notes</li>
                            </ul>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-info">File Format:</h6>
                            <p class="mb-0">All reports are generated in CSV format for easy import into spreadsheet applications.</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-info">Data Privacy:</h6>
                            <p class="mb-0">Reports contain sensitive medical information. Please handle according to your privacy policies.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Quick Statistics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border-end">
                                <h3 class="text-success">{{ current_user.received_donations|selectattr('status', 'equalto', 'approved')|list|length }}</h3>
                                <p class="mb-0">Total Donations</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border-end">
                                <h3 class="text-warning">{{ current_user.received_requests|list|length }}</h3>
                                <p class="mb-0">Total Requests</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border-end">
                                <h3 class="text-info">{{ current_user.received_requests|selectattr('status', 'equalto', 'approved')|list|length }}</h3>
                                <p class="mb-0">Approved Requests</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-primary">{{ current_user.blood_inventory|map(attribute='units_available')|sum }}</h3>
                            <p class="mb-0">Current Stock</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}